# Results {#results}

The pattern of population growth over time when no genome-doubling occurred was consistent and predictable. The main metric examined here was the freqeuncy of individuals at a particular life-stage. From herein, frequency describes the number of individuals observed (either belonging to a particular life-stage, or to a particlar ploidy type) relative to the carrying capacity of the entire population (number of individuals/carrying capacity). When no genome-doubling occured (figure \ref{fig:results-control}), whatever the starting population size, the frequency of adult individuals (seedlings) quickly stabilised (in under fifty generations) around the carrying capacity (mean frequency = 1.00, sd = 0.00163) with seed counts at just under three-quarters of the adult population size (mean frequency = 0.729, sd = 0.00210). When genome-doubling was included in the simulations, this stability gradually became disrupted as the doubling rate was increased. At first polyploid frequency began to rise and stabilise around greater frequencies, increasing the variation in seed output as fertilistion success became gradually less predictable. The effect of seed output meant that there came a point when increasing the genome-doubling rate could not raise the stable frequncy of polyploids any higher. Instead, above this threshold (0.171), the stability of the whole population suffered so that both diploids and polyploids declined until the population reached extinction (see figures \ref{fig:results-threshold} and \ref{fig:results-interference}).

>If I'm going to talk about variation in seed output does this need a plot? Otherwise remove all the bits about seeds?

## Did the proportion of polyploids exceed the rate of genome-doubling?

At genome-doubling rates between 0.001 and 0.01, we saw--and demonstrate in figure \ref{fig:results-cost}--that polyploid frequencies spread evenly around around the rate of duplication (mean relative frequency at generation 1000 = 1.00, sd = 0.0617, CI = 0.881 to 1.12, N = 375). Out of these 375 simulations, almost half (46.9%) of the polyploid population frequencies fell just below the genome-doubling rate and the other half (53.1%) made it slightly over. However, once the rate of duplication increased past 0.01, the polyploids that appeared began to consistently escape the negative selection caused by pollen-swamping. Between genome-doubling rates of 0.01 and 0.171, only one polyploid population in 194 (0.5%) ended the simulation with a frequency below it's genome-doubling rate; the overall trend was one of increased population growth for polyploids (mean relative frequency = 1.23, sd = 0.122, CI = 0.988 to 1.46, N = 194). The maximum relative frequency of polyploids observed was 1.39, seen in 2 simulations with genome-doubling rates of 0.167 and 0.170.


>Explain more why figure \ref{fig:results-cost} is a thing. Luc thinks the reasoning for these axes is wooly.

>Should I fit a model for the relative frequencies?

Out of 411 simulations that had a genome-doubling rate over 0.171, only 15 (3.65%) had survivors at 1000 generations. Figure \ref{fig:results-threshold} shows the difference in population growth patterns. Below the threshold, all 569 simulations survived to 1000 generations, and the majority (98.8%) reached stability; seven simulations with a genome-doubling rate that rounded to 0.171 were less predictable and showed patterns of booms and busts. Figure \ref{fig:results-interference} shows the frequency of diploids and polyploids reached for all populations that survived to 1000 generations with genome-doubling enabled at random rates between 0.001 and 0.25. As the rate of genome-doubling was increased, maximum polyploid frequencies rose while diploid frequencies fell until a threshold rate was reached; once the genome-doubling rate exceeded 0.171 neither diploids or polyploids survived well. 

>Explain more why figure \ref{fig:results-threshold} is even here.
>Should I fit a model for extinction?
>Translate this back to braod concepts.

## Did increasing the genome-doubling rate lead to the fixation of polyploidy?

As seen in figures \ref{fig:results-interference} and \ref{fig:results-threshold}, out of 994 simulations with genome-doubling enabled, polyploidy never made it to fixation. In fact, polyploid populations never represented more than a quarter of the landscape; the maximum polyploid frequency of surviving simulations at generation 1000 was 0.236. Increasing the rate of genome-doubling, alone, was not sufficient for polyploids to dominate diploids on the landscape, let alone outcompete them and take over. 

>Translate this back to braod concepts.

## Did established, and pioneering populations react in the same way to increased genome-doubling rates?

No matter whether simulations began with small or large numbers of diploids, the overall patterns observed were the same; polyploid growth and stability below a rate of 0.171 or decline and ultimate extinction at rates over that threshold. The main difference starting population size made, was to the length of time it took for the diploids and polyploids to reach their stable frequency range, or to reach extinction (see figure \ref{fig:results-threshold}). For extremely low starting population sizes, some extinction was observed at genome-doubling rates below 0.171. Extremely high starting population sizes did not appear to buffer against this effect, though in some cases they did delay it. Figure \ref{fig:results-extinctions} shows the sudden mass of extinction events that occurred as the rate of duplication was increased; outliers had particularly low or high starting population sizes.

>I think I need to pull some actual numbers out of the data here.
>Translate this back to broad concepts.

```{r results-setup, echo=FALSE, message=FALSE, warning=FALSE}
# 1 = green, 2 = blue , 3 = bright blue, 4 = red, 5 = black
ploidy_colours = c("#30a068", "#39bbf7", "#3d85c6", "#cc0000", "#000000") 
real_auto_rate = 0.0056
real_allo_rate = 0.2752

control <- readRDS("_data/control.rds")
simulations <- readRDS("_data/simulations.rds")
source("results.R")

theme_ploidy <- theme(
  legend.position = "top",
  legend.title = element_text(size = 7, face = "bold"),
  legend.text = element_text(size = 7, face = "bold"),
  axis.title = element_text(size = 7, face = "bold"),
  plot.background = element_rect(fill = "#efefef"),
  strip.background = element_rect(colour = "white"),
  strip.text = element_text(size = 7, face = "bold")
)
```

```{r results-control, dev="png", dpi=300, fig.height=2.5, fig.cap="\\label{fig:results-control}Diploid opulation growth when no genome-doubling occured. Each point represents the frequency of seedlings within the population (count/carrying capacity) at the end of any given generation (N = 100 simulations)."}
control %>%
  tidyr::unnest(cols = c(data)) %>%
  ggplot2::ggplot(aes(x = gen, y = adults)) +
    ggplot2::geom_point(alpha = .2, size = .2) +
    ggplot2::theme_classic() +
    ggplot2::theme(
      legend.position = "none",
      axis.title = element_text(size = 7, face = "bold"),
      plot.background = element_rect(fill = "#efefef"),
      strip.background = element_rect(colour = "white"),
      strip.text = element_text(size = 7, face = "bold")
    ) +
    ggplot2::xlab("Time (generations)") +
    ggplot2::ylab("Frequency of adults in population") +
    ggplot2::scale_x_continuous(
      breaks = seq(0, 1000, 500), 
      limits = c(0, 1000)
    ) +
    ggplot2::scale_y_continuous(
      breaks = seq(0, 1, .5), 
      limits = c(0, 1.01)
    )
```

```{r results-hist, dev="png", dpi=300, fig.cap="\\label{fig:results-hist}textbd{Simulations subset by outcome:} Each bin in the stacked histogram shows the number of simulations (from 1000 instances) within that group of nonreduction rates that had a particular outcome. Simulations with stable coexistence (green) had a total adult population around the carrying capacity (100000) with both diploids and polyploids surviving throughout all 1000 generations. Simulations with total extinction (black) had neither diploid or adults surviving tp 1000 generations. Those with polyploids that were the only survivors are shown in blue. Stable polyploid populations (bright blue) had maximum frequencies of adults relative to the possible population size (over 0.99), while unstable polyploid populations (blue) had extremely low frequencies of adults persisting (0.00001)."}
tibble::tibble(
  ploidy_rate = c(
    stability$ploidy_rate, 
    stable_polyploid_winners %>% pull(ploidy_rate),
    unstable_polyploid_winners %>% pull(ploidy_rate),
    extinctions$ploidy_rate
  ),
  survival = c(
    rep("coexistence (stable)", length(stability$ploidy_rate)), 
    rep("polyploid fixation (stable)", length(stable_polyploid_winners$ploidy_rate)), 
    rep("polyploid fixation (unstable)", length(unstable_polyploid_winners$ploidy_rate)), 
    rep("total extinction", length(extinctions$ploidy_rate))
  )
) %>%
  ggplot(aes(x = ploidy_rate, fill = survival)) + 
    geom_histogram(colour = "white", bins = 50) +
    scale_fill_manual(values = c(ploidy_colours, "#000000")) +
    xlab("Rate of nonreduction") +
    ylab("Number of simulations") +
    labs(fill = "") +
    theme_classic() + theme_ploidy
```

```{r, results-stability, dev="png", dpi=300, fig.cap="\\label{fig:results-stability}\\textbd{Coexistence:} Stable frequencies of ploidy types as a function of nonreduction rate. Points represent total polyploid (blue), sterile polyploid (red) and viable polyploid (green) frequency relative to diploids in the population at generation 1000. Each point represents one of 341 simulations out of 1000 which achieved stable coexistence (i.e:- having predictable frequencies around this range which had persisted over many generations). The solid black line shows where frequency equals rate of nonreduction, the dotted line marks a frequency equal to half the rate, and the dashed line marks a frequency equal to double the rate."}
simulations %>%
  dplyr::filter(ID %in% stability$ID) %>%
  tidyr::unnest(cols = c(data)) %>%
  dplyr::filter(gen == 1000) %>%
  dplyr::mutate(viable_polyploid_adults = polyploid_adults - sterile_polyploid_adults) %>%
  dplyr::select(-total) %>%
  tidyr::gather(subset, count, polyploid_adults:viable_polyploid_adults) %>%
  ggplot(aes(x = ploidy_rate, y = count, colour = subset)) +
  geom_point(alpha = .7) +
  geom_line(
    data = tibble(
      ploidy_rate = seq(0, 0.1513566, length.out = 1000),
      count = ploidy_rate
    ),
    colour = "black"
  ) +
  geom_line(
    data = tibble(
      ploidy_rate = seq(0, 0.1513566, length.out = 1000),
      count = ploidy_rate / 2
    ),
    colour = "black",
    linetype = "dotted"
  ) +
  geom_line(
    data = tibble(
      ploidy_rate = seq(0, 0.1513566, length.out = 1000),
      count = ploidy_rate * 2
    ),
    colour = "black",
    linetype = "dashed"
  ) +
  scale_y_continuous(breaks = seq(0, .4, .2, )) +
  scale_colour_manual(
    values = ploidy_colours[c(2,4,1)], 
    labels = c("polyploid", "sterile polyploid", "viable polyploid"),
    name = ""
  ) +
  xlab("Rate of nonreduction") +
  ylab("Frequency of adults in population") +
  theme_classic() + theme_ploidy +
  theme(legend.position = c(0.1, .86), legend.margin = margin(0, 0, 0, 0, "cm"))
```

```{r results-cost, dev="png", dpi=300, fig.cap="\\label{fig:results-cost}textbd{Escaping the cost of pollen-swamping:} Points represent simulations where the rate of genome-doubling was between 0.001 and 0.171 (N = 569). Each point (green) shows the the frequency of polyploids at the end of the simulation (generation 1000) relative to the rate of genome-doubling set (frequency/rate). The solid black line represents the mean relative frequency for genome-doubling rates rounded to 2 decimal places, and the dotted black lines represent the 95% confidence envelope around the mean."}
cost %>%
  dplyr::filter(between(ploidy_rate, 0.001, 0.171)) %>%
  ggplot(aes(x = ploidy_rate, y = diff)) +
  geom_point(alpha = .4, colour = ploidylvl_colours[2]) +
  geom_line(
    aes(y = mean),
    data = cost_summary,
    colour = "black"
  ) +
  geom_line(
    aes(y = lower),
    data = cost_summary,
    colour = "black",
    linetype = "dotted"
  ) +
  geom_line(
    aes(y = upper),
    data = cost_summary,
    colour = "black",
    linetype = "dotted"
  ) +
  theme_classic() +
    theme(
      legend.position = "top",
      axis.title = element_text(size = 7, face = "bold"),
      plot.background = element_rect(fill = "#efefef"),
      strip.background = element_rect(colour = "white"),
      strip.text = element_text(size = 7, face = "bold")
    ) +
    xlab("Rate of genome-doubling") +
    ylab("Frequency of polyploids / rate of genome-doubling") +
    scale_x_continuous(
      breaks = seq(0.01, 0.17, .04),
      limits = c(0, .175)
    ) 
```

```{r results-extinctions, dev="png", dpi=300, fig.height=2.5, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="\\label{fig:results-extinctions}\\textbd{Extinction events as a function of the rate of gametic nonreduction:} each point represents one of the 455 simulations out of 1000 where both diploids and polyploids went extinct before one thousand generations had passed."}
extinctions %>%
  dplyr::ungroup() %>%
  dplyr::mutate(
    starting_N_group = "whatever",
    starting_N_group = replace(
      starting_N_group, which(extinctions$starting_N < 50000), "less than 50000"
    ),
    starting_N_group = replace(
      starting_N_group, which(extinctions$starting_N >= 50000), "50000 and above"
    ) 
  ) %>%
  ggplot2::ggplot(aes(x = ploidy_rate, y = gen_extinction_occurred, colour = starting_N_group)) +
    geom_point(alpha = .7) +
    scale_colour_manual(values = c(ploidy_colours[2], "#000000")) +
    #geom_vline(xintercept = real_auto_rate, colour = "red") +
    geom_vline(xintercept = 0.15, colour = "red", linetype = "dotted") +
    xlab("Rate of nonreduction") +
    ylab("Generation at extinction") +
    scale_x_continuous(limits = c(0, 0.5)) +
    labs(colour = "Starting population size")
    theme_classic() + theme_ploidy
```
